{{define "toast-container"}}
{{- /* Toast Notification Container
    
    This component provides a global toast notification system with:
    - Auto-dismiss with configurable duration (default 5000ms)
    - Maximum 4 visible toasts (oldest removed when limit exceeded)
    - Manual dismiss via close button
    - Support for variants: success, error, info, warning
    - Positioned in top-right corner with vertical stacking
    - Enter/leave transitions
    - Dark mode support
    
    Usage:
    1. Include this component in base.html (once per page)
    2. Trigger from JavaScript:
       window.dispatchEvent(new CustomEvent('toast', { 
         detail: { variant: 'success', message: 'Operation completed', duration: 5000 } 
       }));
    
    3. Trigger from backend via HTMX HX-Trigger header:
       w.Header().Set("HX-Trigger", `{"toast": {"variant": "success", "message": "Saved successfully"}}`)
    
    Variants:
    - success: Green border, for successful operations
    - error: Red border, for errors and failures
    - info: Blue border, for informational messages
    - warning: Yellow border, for warnings and cautions
*/ -}}

<div 
    x-data="toastManager()" 
    @toast.window="addToast($event.detail)"
    class="fixed top-4 right-4 z-50 space-y-3 pointer-events-none"
    style="max-width: 24rem;"
>
    <template x-for="toast in toasts" :key="toast.id">
        <div 
            x-show="toast.visible"
            x-transition:enter="transition ease-out duration-200 transform"
            x-transition:enter-start="translate-x-full opacity-0"
            x-transition:enter-end="translate-x-0 opacity-100"
            x-transition:leave="transition ease-in duration-150 transform"
            x-transition:leave-start="translate-x-0 opacity-100"
            x-transition:leave-end="translate-x-full opacity-0"
            class="bg-white dark:bg-surface-800 rounded-lg shadow-lg border-l-4 p-4 pointer-events-auto"
            :class="{
                'border-success-500': toast.variant === 'success',
                'border-error-500': toast.variant === 'error',
                'border-info-500': toast.variant === 'info',
                'border-warning-500': toast.variant === 'warning'
            }"
            role="alert"
            aria-live="polite"
        >
            <div class="flex items-start gap-3">
                <!-- Icon -->
                <div class="flex-shrink-0 mt-0.5">
                    <!-- Success icon -->
                    <svg 
                        x-show="toast.variant === 'success'" 
                        class="w-5 h-5 text-success-500" 
                        fill="currentColor" 
                        viewBox="0 0 20 20"
                    >
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    
                    <!-- Error icon -->
                    <svg 
                        x-show="toast.variant === 'error'" 
                        class="w-5 h-5 text-error-500" 
                        fill="currentColor" 
                        viewBox="0 0 20 20"
                    >
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    
                    <!-- Info icon -->
                    <svg 
                        x-show="toast.variant === 'info'" 
                        class="w-5 h-5 text-info-500" 
                        fill="currentColor" 
                        viewBox="0 0 20 20"
                    >
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                    
                    <!-- Warning icon -->
                    <svg 
                        x-show="toast.variant === 'warning'" 
                        class="w-5 h-5 text-warning-500" 
                        fill="currentColor" 
                        viewBox="0 0 20 20"
                    >
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                </div>
                
                <!-- Message -->
                <div class="flex-1 text-sm text-surface-900 dark:text-surface-100" x-text="toast.message"></div>
                
                <!-- Close button -->
                <button 
                    @click="removeToast(toast.id)" 
                    class="flex-shrink-0 text-surface-400 hover:text-surface-600 dark:text-surface-500 dark:hover:text-surface-300 transition-colors focus:outline-none focus:ring-2 focus:ring-surface-500 rounded"
                    aria-label="Close notification"
                >
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>
    </template>
</div>

<script>
/**
 * Toast Manager Alpine.js Component
 * 
 * Manages a queue of toast notifications with the following features:
 * - Maximum 4 visible toasts (oldest removed when limit exceeded)
 * - Auto-dismiss after configurable duration (default 5000ms)
 * - Manual dismiss via close button
 * - Smooth enter/leave transitions
 * 
 * @returns {Object} Alpine.js component data
 */
function toastManager() {
    return {
        toasts: [],
        nextId: 1,
        
        /**
         * Add a new toast to the queue
         * @param {Object} toastData - Toast configuration
         * @param {string} toastData.variant - Toast variant: 'success', 'error', 'info', 'warning'
         * @param {string} toastData.message - Toast message text
         * @param {number} [toastData.duration=5000] - Auto-dismiss duration in milliseconds
         */
        addToast(toastData) {
            // Validate variant
            const validVariants = ['success', 'error', 'info', 'warning'];
            const variant = validVariants.includes(toastData.variant) ? toastData.variant : 'info';
            
            // Create toast object
            const id = this.nextId++;
            const newToast = {
                id: id,
                variant: variant,
                message: toastData.message || 'Notification',
                visible: true
            };
            
            // Add to queue
            this.toasts.push(newToast);
            
            // Enforce maximum of 4 visible toasts
            if (this.toasts.length > 4) {
                const oldestToast = this.toasts[0];
                this.removeToast(oldestToast.id);
            }
            
            // Schedule auto-dismiss
            const duration = toastData.duration || 5000;
            setTimeout(() => {
                this.removeToast(id);
            }, duration);
        },
        
        /**
         * Remove a toast from the queue
         * @param {number} toastId - ID of the toast to remove
         */
        removeToast(toastId) {
            const toast = this.toasts.find(t => t.id === toastId);
            if (!toast) {
                return;
            }
            
            // Trigger exit transition
            toast.visible = false;
            
            // Remove from array after transition completes (200ms)
            setTimeout(() => {
                this.toasts = this.toasts.filter(t => t.id !== toastId);
            }, 200);
        }
    };
}
</script>
{{end}}
