{{define "settings-content"}}
<div class="settings-container">
    <!-- Settings Header -->
    <div class="settings-header">
        <div class="settings-title">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/>
            </svg>
            <h1>Settings</h1>
        </div>
        <button class="btn-primary" onclick="saveSettings()">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z"/>
            </svg>
            Save Settings
        </button>
    </div>

    <form id="settingsForm" class="settings-form">
        <!-- Privacy Controls Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2>Privacy Controls</h2>
                <p class="section-description">Configure which AI provider to use by default and control data sharing policies.</p>
            </div>
            
            <div class="form-group">
                <label for="defaultProvider">Default Provider</label>
                <select id="defaultProvider" name="use_local_ai" onchange="updateDefaultProvider()">
                    <option value="true" {{if .Config.Privacy.UseLocalAI}}selected{{end}}>üîí Local AI (Ollama)</option>
                    <option value="false" {{if not .Config.Privacy.UseLocalAI}}selected{{end}}>‚òÅÔ∏è Cloud AI (OpenAI/Anthropic)</option>
                </select>
                <small class="form-hint">Choose which provider to use by default. You can switch between them anytime using the privacy toggle in the chat interface.</small>
            </div>

            {{if .CurrentUser.IsAdmin}}
            <div class="form-group">
                <label for="cloudRagPolicy">Cloud AI RAG Policy</label>
                <select id="cloudRagPolicy" name="cloud_rag_policy">
                    <option value="no_rag" {{if eq .Config.Privacy.CloudRAGPolicy "no_rag"}}selected{{end}}>No RAG with Cloud AI</option>
                    <option value="allow_rag" {{if eq .Config.Privacy.CloudRAGPolicy "allow_rag"}}selected{{end}}>Allow RAG with Cloud AI</option>
                </select>
                <small class="form-hint">
                    <strong>No RAG:</strong> Cloud AI receives only your query (maximum privacy).<br>
                    <strong>Allow RAG:</strong> Cloud AI receives your query plus relevant document snippets (better context).
                </small>
            </div>
            {{end}}
        </section>

        <!-- AI Provider Configuration Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2>AI Provider Configuration</h2>
                <p class="section-description">Current provider settings from config.json. Edit the config file directly to change providers.</p>
            </div>

            <!-- Local Provider Display -->
            <div class="provider-display">
                <h3>üîí Local AI Provider</h3>
                {{if .Config.LocalProvider.Type}}
                <div class="config-display">
                    <div class="config-item">
                        <span class="config-label">Type:</span>
                        <span class="config-value">{{.Config.LocalProvider.Type}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Endpoint:</span>
                        <span class="config-value">{{.Config.LocalProvider.OllamaEndpoint}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Embed Model:</span>
                        <span class="config-value">{{.Config.LocalProvider.OllamaEmbedModel}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Chat Model:</span>
                        <span class="config-value">{{.Config.LocalProvider.OllamaChatModel}}</span>
                    </div>
                </div>
                <button type="button" class="btn-secondary" onclick="testConnection('local')">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    Test Local Connection
                </button>
                {{else}}
                <div class="empty-state">
                    <p>Not configured</p>
                </div>
                {{end}}
            </div>

            <!-- Cloud Provider Display -->
            <div class="provider-display">
                <h3>‚òÅÔ∏è Cloud AI Provider</h3>
                {{if .Config.CloudProvider.Type}}
                <div class="config-display">
                    <div class="config-item">
                        <span class="config-label">Type:</span>
                        <span class="config-value">{{.Config.CloudProvider.Type}}</span>
                    </div>
                    {{if eq .Config.CloudProvider.Type "openai"}}
                    <div class="config-item">
                        <span class="config-label">API Key:</span>
                        <span class="config-value">{{if .Config.CloudProvider.OpenAIKey}}‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢{{else}}Not set{{end}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Embed Model:</span>
                        <span class="config-value">{{.Config.CloudProvider.OpenAIEmbedModel}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Chat Model:</span>
                        <span class="config-value">{{.Config.CloudProvider.OpenAIChatModel}}</span>
                    </div>
                    {{else if eq .Config.CloudProvider.Type "anthropic"}}
                    <div class="config-item">
                        <span class="config-label">API Key:</span>
                        <span class="config-value">{{if .Config.CloudProvider.AnthropicKey}}‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢{{else}}Not set{{end}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Embed Model:</span>
                        <span class="config-value">{{.Config.CloudProvider.AnthropicEmbedModel}}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Chat Model:</span>
                        <span class="config-value">{{.Config.CloudProvider.AnthropicChatModel}}</span>
                    </div>
                    {{end}}
                    <div class="config-item">
                        <span class="config-label">RAG Policy:</span>
                        <span class="config-value">{{if eq .Config.Privacy.CloudRAGPolicy "no_rag"}}No RAG (Maximum Privacy){{else if eq .Config.Privacy.CloudRAGPolicy "allow_rag"}}Allow RAG{{else}}{{.Config.Privacy.CloudRAGPolicy}}{{end}}</span>
                    </div>
                </div>
                <button type="button" class="btn-secondary" onclick="testConnection('cloud')">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    Test Cloud Connection
                </button>
                {{else}}
                <div class="empty-state">
                    <p>Not configured</p>
                </div>
                {{end}}
            </div>

            <div class="config-note">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                </svg>
                <p>To update or change AI provider settings, please edit the <code>config.json</code> file directly. See <code>LLM-PROVIDER-SETUP.md</code> for configuration details.</p>
            </div>
        </section>



        <!-- Watched Folders Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2>Watched Folders</h2>
                <p class="section-description">Automatically ingest files from these folders when they are added or modified.</p>
            </div>

            <div id="watchedFoldersList" class="watched-folders-list">
                {{range $index, $folder := .Config.Folders}}
                <div class="folder-item">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                    </svg>
                    <span class="folder-path">{{$folder}}</span>
                    <button type="button" class="btn-icon btn-remove" onclick="removeFolder({{$index}})" title="Remove folder">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                        </svg>
                    </button>
                </div>
                {{end}}
                {{if not .Config.Folders}}
                <div class="empty-state">
                    <p>No watched folders configured</p>
                </div>
                {{end}}
            </div>

            <div class="form-group">
                <label for="newFolderPath">Add Folder</label>
                <div class="input-with-button">
                    <input type="text" id="newFolderPath" placeholder="/path/to/folder">
                    <button type="button" class="btn-secondary" onclick="addFolder()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                        </svg>
                        Add
                    </button>
                </div>
                <small class="form-hint">Enter the full path to a folder to watch for changes</small>
            </div>
        </section>

        <!-- Guardrails Section -->
        <section class="settings-section">
            <div class="section-header">
                <h2>Guardrails</h2>
                <p class="section-description">Configure safety and privacy features for document ingestion.</p>
            </div>

            <div class="form-group">
                <label for="piiDetection">PII Detection</label>
                <select id="piiDetection" name="pii_detection">
                    <option value="strict" {{if eq .Config.Guardrails.PIIDetection "strict"}}selected{{end}}>Strict - Block all potential PII</option>
                    <option value="normal" {{if eq .Config.Guardrails.PIIDetection "normal"}}selected{{end}}>Normal - Warn on common PII patterns</option>
                    <option value="off" {{if eq .Config.Guardrails.PIIDetection "off"}}selected{{end}}>Off - No PII detection</option>
                </select>
                <small class="form-hint">Detect and warn about personally identifiable information</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="autoSummarize" name="auto_summarize" 
                           {{if .Config.Guardrails.AutoSummarize}}checked{{end}}>
                    <span>Auto-summarize documents on ingestion</span>
                </label>
                <small class="form-hint">Automatically generate summaries for ingested documents</small>
            </div>

            <div class="form-group">
                <label for="maxFileSize">Max File Size (MB)</label>
                <input type="number" id="maxFileSize" name="max_file_size_mb" 
                       value="{{.Config.Guardrails.MaxFileSizeMB}}"
                       min="1" max="100">
                <small class="form-hint">Maximum file size for ingestion</small>
            </div>

            <div class="form-group">
                <label for="maxConcurrent">Max Concurrent Ingestions</label>
                <input type="number" id="maxConcurrent" name="max_concurrent" 
                       value="{{.Config.Guardrails.MaxConcurrent}}"
                       min="1" max="10">
                <small class="form-hint">Number of files to process simultaneously</small>
            </div>
        </section>

        <!-- User Profile Section (Multi-User Mode) -->
        {{if .UserMode}}
        {{if eq .UserMode "multi"}}
        <section class="settings-section">
            <div class="section-header">
                <h2>User Profile</h2>
                <p class="section-description">Manage your account settings and profile information.</p>
            </div>

            <div class="user-profile-info">
                <div class="profile-field">
                    <label>Username</label>
                    <div class="profile-value">{{.CurrentUser.Username}}</div>
                </div>
                <div class="profile-field">
                    <label>Email</label>
                    <div class="profile-value">{{.CurrentUser.Email}}</div>
                </div>
                <div class="profile-field">
                    <label>Account Type</label>
                    <div class="profile-value">
                        {{if .CurrentUser.IsAdmin}}
                        <span class="badge badge-admin">Administrator</span>
                        {{else}}
                        <span class="badge badge-user">User</span>
                        {{end}}
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <button type="button" class="btn-secondary" onclick="showChangePasswordModal()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                    </svg>
                    Change Password
                </button>
                <button type="button" class="btn-secondary" onclick="logout()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"/>
                    </svg>
                    Logout
                </button>
            </div>
        </section>
        {{end}}
        {{end}}

        <!-- User Management Section (Admin Only) -->
        {{if .UserMode}}
        {{if eq .UserMode "multi"}}
        {{if .CurrentUser.IsAdmin}}
        <section class="settings-section">
            <div class="section-header">
                <h2>User Management</h2>
                <p class="section-description">Manage user accounts and permissions.</p>
            </div>

            <div class="user-management-controls">
                <button type="button" class="btn-primary" onclick="showCreateUserModal()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"/>
                    </svg>
                    Create User
                </button>
            </div>

            <div id="usersList" class="users-table-container">
                <!-- Users table will be loaded here -->
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading users...</p>
                </div>
            </div>
        </section>
        {{end}}
        {{end}}
        {{end}}
    </form>
</div>

<!-- Create/Edit User Modal -->
<div id="userModal" class="modal hidden">
    <div class="modal-backdrop" onclick="closeUserModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="userModalTitle">Create User</h2>
            <button class="modal-close" onclick="closeUserModal()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                </svg>
            </button>
        </div>
        <form id="userForm" class="modal-form">
            <input type="hidden" id="userId" name="user_id">
            
            <div class="form-group">
                <label for="modalUsername">Username</label>
                <input type="text" id="modalUsername" name="username" required>
            </div>

            <div class="form-group">
                <label for="modalEmail">Email</label>
                <input type="email" id="modalEmail" name="email" required>
            </div>

            <div class="form-group" id="passwordGroup">
                <label for="modalPassword">Password</label>
                <input type="password" id="modalPassword" name="password" minlength="8">
                <small class="form-hint">Minimum 8 characters</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="modalIsAdmin" name="is_admin">
                    <span>Administrator</span>
                </label>
            </div>

            <div id="modalError" class="error-message hidden"></div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeUserModal()">Cancel</button>
                <button type="submit" class="btn-primary" id="userFormSubmit">Create User</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete User Confirmation Modal -->
<div id="deleteUserModal" class="modal hidden">
    <div class="modal-backdrop" onclick="closeDeleteUserModal()"></div>
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>Delete User</h2>
            <button class="modal-close" onclick="closeDeleteUserModal()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete user <strong id="deleteUsername"></strong>?</p>
            <p class="text-warning">This action cannot be undone. All user data will be permanently deleted.</p>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeDeleteUserModal()">Cancel</button>
            <button type="button" class="btn-danger" onclick="confirmDeleteUser()">Delete User</button>
        </div>
    </div>
</div>

<!-- Reset Password Modal -->
<div id="resetPasswordModal" class="modal hidden">
    <div class="modal-backdrop" onclick="closeResetPasswordModal()"></div>
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>Reset Password</h2>
            <button class="modal-close" onclick="closeResetPasswordModal()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p>A temporary password will be generated for user <strong id="resetUsername"></strong>.</p>
            <p>The user will be required to change their password on next login.</p>
            <div id="tempPasswordDisplay" class="temp-password-box hidden">
                <label>Temporary Password:</label>
                <div class="temp-password">
                    <code id="tempPassword"></code>
                    <button type="button" class="btn-icon" onclick="copyTempPassword()" title="Copy to clipboard">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                        </svg>
                    </button>
                </div>
                <small class="form-hint">Make sure to save this password. It will not be shown again.</small>
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeResetPasswordModal()">Close</button>
            <button type="button" class="btn-primary" id="resetPasswordButton" onclick="confirmResetPassword()">Generate Password</button>
        </div>
    </div>
</div>

<script>
// Track watched folders in memory
let watchedFolders = [{{range $index, $folder := .Config.Folders}}{{if $index}},{{end}}"{{$folder}}"{{end}}];
let deleteUserIdPending = null;
let resetUserIdPending = null;

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load users list if in multi-user mode and user is admin
    {{if .UserMode}}
    {{if eq .UserMode "multi"}}
    {{if .CurrentUser.IsAdmin}}
    loadUsersList();
    {{end}}
    {{end}}
    {{end}}
});

// Update default provider selection
function updateDefaultProvider() {
    const useLocalAI = document.getElementById('defaultProvider').value === 'true';
    // This will be saved when the form is submitted
}

// Add a watched folder
function addFolder() {
    const input = document.getElementById('newFolderPath');
    const path = input.value.trim();
    
    if (!path) {
        alert('Please enter a folder path');
        return;
    }
    
    if (watchedFolders.includes(path)) {
        alert('Folder is already in the watch list');
        return;
    }
    
    watchedFolders.push(path);
    input.value = '';
    renderWatchedFolders();
}

// Remove a watched folder
function removeFolder(index) {
    if (confirm('Remove this folder from the watch list?')) {
        watchedFolders.splice(index, 1);
        renderWatchedFolders();
    }
}

// Render watched folders list
function renderWatchedFolders() {
    const container = document.getElementById('watchedFoldersList');
    
    if (watchedFolders.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <p>No watched folders configured</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = watchedFolders.map((folder, index) => `
        <div class="folder-item">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
            </svg>
            <span class="folder-path">${folder}</span>
            <button type="button" class="btn-icon btn-remove" onclick="removeFolder(${index})" title="Remove folder">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                </svg>
            </button>
        </div>
    `).join('');
}

// Test provider connection
async function testConnection(providerMode) {
    const formData = new FormData(document.getElementById('settingsForm'));
    
    // Add provider mode to form data
    formData.append('test_provider_mode', providerMode);
    
    try {
        const response = await fetch('/api/test-connection', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            alert(`${providerMode === 'local' ? 'Local' : 'Cloud'} provider connection successful!`);
        } else {
            alert(`${providerMode === 'local' ? 'Local' : 'Cloud'} provider connection failed: ` + (result.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Connection test failed:', error);
        alert('Connection test failed: ' + error.message);
    }
}

// Save settings
async function saveSettings() {
    const formData = new FormData(document.getElementById('settingsForm'));
    
    // Add watched folders to form data
    formData.delete('folders'); // Clear any existing
    watchedFolders.forEach(folder => {
        formData.append('folders', folder);
    });
    
    // Collect privacy toggle state
    const useLocalAI = document.getElementById('defaultProvider').value;
    
    // Collect RAG policy (if admin)
    const cloudRagPolicyElement = document.getElementById('cloudRagPolicy');
    const cloudRagPolicy = cloudRagPolicyElement ? cloudRagPolicyElement.value : '';
    
    // Convert FormData to URLSearchParams for proper form encoding
    const params = new URLSearchParams();
    for (const [key, value] of formData.entries()) {
        params.append(key, value);
    }
    
    // Add privacy settings
    params.set('use_local_ai', useLocalAI);
    if (cloudRagPolicy) {
        params.set('cloud_rag_policy', cloudRagPolicy);
    }
    
    try {
        const response = await fetch('/api/config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: params.toString()
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            // Display confirmation message on successful save
            if (typeof showToast === 'function') {
                showToast('Settings saved successfully! Some changes may require a restart.', 'success');
            } else {
                alert('Settings saved successfully! Some changes may require a restart.');
            }
        } else {
            // Display field-specific error messages on validation failure
            const errorMessage = result.error || 'Unknown error';
            if (typeof showToast === 'function') {
                showToast('Failed to save settings: ' + errorMessage, 'error');
            } else {
                alert('Failed to save settings: ' + errorMessage);
            }
        }
    } catch (error) {
        console.error('Failed to save settings:', error);
        if (typeof showToast === 'function') {
            showToast('Failed to save settings: ' + error.message, 'error');
        } else {
            alert('Failed to save settings: ' + error.message);
        }
    }
}

// User Management Functions

// Load users list
async function loadUsersList() {
    const container = document.getElementById('usersList');
    if (!container) return;
    
    try {
        const response = await fetch('/api/users');
        const users = await response.json();
        
        if (response.ok) {
            renderUsersTable(users);
        } else {
            container.innerHTML = '<div class="error-state"><p>Failed to load users</p></div>';
        }
    } catch (error) {
        console.error('Failed to load users:', error);
        container.innerHTML = '<div class="error-state"><p>Failed to load users</p></div>';
    }
}

// Render users table
function renderUsersTable(users) {
    const container = document.getElementById('usersList');
    if (!container) return;
    
    if (users.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No users found</p></div>';
        return;
    }
    
    const table = `
        <table class="users-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Created</th>
                    <th>Last Login</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                ${users.map(user => `
                    <tr>
                        <td>${escapeHtml(user.username)}</td>
                        <td>${escapeHtml(user.email || '-')}</td>
                        <td>
                            ${user.is_admin ? '<span class="badge badge-admin">Admin</span>' : '<span class="badge badge-user">User</span>'}
                        </td>
                        <td>${formatDate(user.created_at)}</td>
                        <td>${user.last_login ? formatDate(user.last_login) : 'Never'}</td>
                        <td class="actions-cell">
                            <button class="btn-icon" onclick="editUser(${user.id})" title="Edit user">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                            </button>
                            <button class="btn-icon" onclick="showResetPasswordModal(${user.id}, '${escapeHtml(user.username)}')" title="Reset password">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger" onclick="showDeleteUserModal(${user.id}, '${escapeHtml(user.username)}')" title="Delete user">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/>
                                </svg>
                            </button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
    
    container.innerHTML = table;
}

// Show create user modal
function showCreateUserModal() {
    const modal = document.getElementById('userModal');
    const form = document.getElementById('userForm');
    const title = document.getElementById('userModalTitle');
    const submitBtn = document.getElementById('userFormSubmit');
    const passwordGroup = document.getElementById('passwordGroup');
    
    // Reset form
    form.reset();
    document.getElementById('userId').value = '';
    document.getElementById('modalError').classList.add('hidden');
    
    // Set create mode
    title.textContent = 'Create User';
    submitBtn.textContent = 'Create User';
    passwordGroup.style.display = 'block';
    document.getElementById('modalPassword').required = true;
    
    modal.classList.remove('hidden');
}

// Edit user
async function editUser(userId) {
    try {
        const response = await fetch(`/api/users/${userId}`);
        const user = await response.json();
        
        if (response.ok) {
            const modal = document.getElementById('userModal');
            const form = document.getElementById('userForm');
            const title = document.getElementById('userModalTitle');
            const submitBtn = document.getElementById('userFormSubmit');
            const passwordGroup = document.getElementById('passwordGroup');
            
            // Populate form
            document.getElementById('userId').value = user.id;
            document.getElementById('modalUsername').value = user.username;
            document.getElementById('modalEmail').value = user.email || '';
            document.getElementById('modalIsAdmin').checked = user.is_admin;
            document.getElementById('modalError').classList.add('hidden');
            
            // Set edit mode
            title.textContent = 'Edit User';
            submitBtn.textContent = 'Update User';
            passwordGroup.style.display = 'none';
            document.getElementById('modalPassword').required = false;
            
            modal.classList.remove('hidden');
        } else {
            if (typeof showToast === 'function') {
                showToast('Failed to load user details', 'error');
            }
        }
    } catch (error) {
        console.error('Failed to load user:', error);
        if (typeof showToast === 'function') {
            showToast('Failed to load user details', 'error');
        }
    }
}

// Close user modal
function closeUserModal() {
    document.getElementById('userModal').classList.add('hidden');
}

// Handle user form submission
document.getElementById('userForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const userId = document.getElementById('userId').value;
    const username = document.getElementById('modalUsername').value.trim();
    const email = document.getElementById('modalEmail').value.trim();
    const password = document.getElementById('modalPassword').value;
    const isAdmin = document.getElementById('modalIsAdmin').checked;
    const errorDiv = document.getElementById('modalError');
    
    errorDiv.classList.add('hidden');
    
    const isEdit = userId !== '';
    const url = isEdit ? `/api/users/${userId}` : '/api/users';
    const method = isEdit ? 'PUT' : 'POST';
    
    const body = {
        username: username,
        email: email,
        is_admin: isAdmin
    };
    
    if (!isEdit) {
        body.password = password;
    }
    
    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(body)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            if (typeof showToast === 'function') {
                showToast(isEdit ? 'User updated successfully' : 'User created successfully', 'success');
            }
            closeUserModal();
            loadUsersList();
        } else {
            errorDiv.textContent = result.error || 'Failed to save user';
            errorDiv.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Failed to save user:', error);
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
    }
});

// Show delete user modal
function showDeleteUserModal(userId, username) {
    deleteUserIdPending = userId;
    document.getElementById('deleteUsername').textContent = username;
    document.getElementById('deleteUserModal').classList.remove('hidden');
}

// Close delete user modal
function closeDeleteUserModal() {
    deleteUserIdPending = null;
    document.getElementById('deleteUserModal').classList.add('hidden');
}

// Confirm delete user
async function confirmDeleteUser() {
    if (!deleteUserIdPending) return;
    
    try {
        const response = await fetch(`/api/users/${deleteUserIdPending}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            if (typeof showToast === 'function') {
                showToast('User deleted successfully', 'success');
            }
            closeDeleteUserModal();
            loadUsersList();
        } else {
            const result = await response.json();
            if (typeof showToast === 'function') {
                showToast(result.error || 'Failed to delete user', 'error');
            }
        }
    } catch (error) {
        console.error('Failed to delete user:', error);
        if (typeof showToast === 'function') {
            showToast('Failed to delete user', 'error');
        }
    }
}

// Show reset password modal
function showResetPasswordModal(userId, username) {
    resetUserIdPending = userId;
    document.getElementById('resetUsername').textContent = username;
    document.getElementById('tempPasswordDisplay').classList.add('hidden');
    document.getElementById('resetPasswordButton').style.display = 'block';
    document.getElementById('resetPasswordModal').classList.remove('hidden');
}

// Close reset password modal
function closeResetPasswordModal() {
    resetUserIdPending = null;
    document.getElementById('resetPasswordModal').classList.add('hidden');
}

// Confirm reset password
async function confirmResetPassword() {
    if (!resetUserIdPending) return;
    
    const button = document.getElementById('resetPasswordButton');
    button.disabled = true;
    button.textContent = 'Generating...';
    
    try {
        const response = await fetch(`/api/users/${resetUserIdPending}/reset-password`, {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (response.ok) {
            // Display temporary password
            document.getElementById('tempPassword').textContent = result.temporary_password;
            document.getElementById('tempPasswordDisplay').classList.remove('hidden');
            button.style.display = 'none';
            
            if (typeof showToast === 'function') {
                showToast('Password reset successfully', 'success');
            }
        } else {
            if (typeof showToast === 'function') {
                showToast(result.error || 'Failed to reset password', 'error');
            }
            closeResetPasswordModal();
        }
    } catch (error) {
        console.error('Failed to reset password:', error);
        if (typeof showToast === 'function') {
            showToast('Failed to reset password', 'error');
        }
        closeResetPasswordModal();
    } finally {
        button.disabled = false;
        button.textContent = 'Generate Password';
    }
}

// Copy temporary password to clipboard
function copyTempPassword() {
    const password = document.getElementById('tempPassword').textContent;
    navigator.clipboard.writeText(password).then(() => {
        if (typeof showToast === 'function') {
            showToast('Password copied to clipboard', 'success');
        }
    }).catch(err => {
        console.error('Failed to copy password:', err);
    });
}

// Show change password modal (for current user)
function showChangePasswordModal() {
    window.location.href = '/change-password';
}

// Logout
async function logout() {
    try {
        const response = await fetch('/api/logout', {
            method: 'POST'
        });
        
        if (response.ok) {
            window.location.href = '/login';
        } else {
            if (typeof showToast === 'function') {
                showToast('Failed to logout', 'error');
            }
        }
    } catch (error) {
        console.error('Logout error:', error);
        if (typeof showToast === 'function') {
            showToast('Failed to logout', 'error');
        }
    }
}

// Utility functions
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
}
</script>

<style>
/* Settings Container */
.settings-container {
    padding: 2rem;
    max-width: 900px;
    margin: 0 auto;
}

/* Settings Header */
.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.settings-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text);
}

.settings-title svg {
    color: var(--primary);
}

.settings-title h1 {
    margin: 0;
    font-size: 1.75rem;
    font-weight: 600;
}

/* Settings Form */
.settings-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

/* Settings Section */
.settings-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
}

.section-header {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
}

.section-header h2 {
    margin: 0 0 0.5rem;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text);
}

.section-description {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Form Groups */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text);
}

.form-group input[type="text"],
.form-group input[type="password"],
.form-group input[type="number"],
.form-group select {
    width: 100%;
    padding: 0.625rem 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--background);
    color: var(--text);
    font-size: 0.875rem;
    font-family: inherit;
    transition: border-color 0.2s;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary);
}

.form-group input:disabled,
.form-group select:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: var(--surface);
}

.form-hint {
    display: block;
    margin-top: 0.375rem;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

/* Toggle Switch */
.toggle-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    user-select: none;
}

.toggle-label input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: relative;
    width: 48px;
    height: 24px;
    background: var(--border);
    border-radius: 12px;
    transition: background 0.2s;
    flex-shrink: 0;
}

.toggle-slider::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: transform 0.2s;
}

.toggle-label input:checked + .toggle-slider {
    background: var(--primary);
}

.toggle-label input:checked + .toggle-slider::before {
    transform: translateX(24px);
}

.toggle-text {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text);
    flex: 1;
}

/* Checkbox Label */
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    user-select: none;
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.checkbox-label span {
    font-size: 0.875rem;
    color: var(--text);
}

/* Provider Settings */
.provider-settings {
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: var(--background);
    border-radius: 6px;
    border: 1px solid var(--border);
}

.provider-settings h3 {
    margin: 0 0 1rem;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
}

/* Provider Display (Read-only) */
.provider-display {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border);
}

.provider-display:last-of-type {
    border-bottom: none;
    margin-bottom: 1rem;
    padding-bottom: 0;
}

.provider-display h3 {
    margin: 0 0 1rem;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
}

.config-display {
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.config-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border);
}

.config-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.config-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.config-value {
    font-size: 0.875rem;
    color: var(--text);
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
}

.config-note {
    display: flex;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-top: 1rem;
}

.config-note svg {
    flex-shrink: 0;
    color: var(--primary);
    margin-top: 0.125rem;
}

.config-note p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

.config-note code {
    padding: 0.125rem 0.375rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 3px;
    font-size: 0.8125rem;
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    color: var(--primary);
}

/* Watched Folders */
.watched-folders-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
    max-height: 300px;
    overflow-y: auto;
}

.folder-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: 6px;
    transition: all 0.2s;
}

.folder-item:hover {
    border-color: var(--primary);
}

.folder-item svg {
    flex-shrink: 0;
    color: var(--primary);
}

.folder-path {
    flex: 1;
    font-size: 0.875rem;
    color: var(--text);
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.btn-remove {
    color: var(--error);
}

.btn-remove:hover {
    background: var(--error-light);
}

/* Input with Button */
.input-with-button {
    display: flex;
    gap: 0.5rem;
}

.input-with-button input {
    flex: 1;
}

.input-with-button button {
    flex-shrink: 0;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 2rem;
    color: var(--text-secondary);
    background: var(--background);
    border: 1px dashed var(--border);
    border-radius: 6px;
}

.empty-state p {
    margin: 0;
    font-size: 0.875rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        padding: 1rem;
    }
    
    .settings-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .input-with-button {
        flex-direction: column;
    }
    
    .input-with-button button {
        width: 100%;
    }
}

/* User Profile Styles */
.user-profile-info {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.profile-field {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.profile-field label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.profile-value {
    font-size: 0.875rem;
    color: var(--text);
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}

.badge-admin {
    background: var(--primary-light);
    color: var(--primary);
}

.badge-user {
    background: var(--border);
    color: var(--text-secondary);
}

.profile-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

/* User Management Styles */
.user-management-controls {
    margin-bottom: 1.5rem;
}

.users-table-container {
    overflow-x: auto;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
}

.users-table thead {
    background: var(--background);
    border-bottom: 2px solid var(--border);
}

.users-table th {
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: var(--text);
}

.users-table td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--border);
    color: var(--text);
}

.users-table tbody tr:hover {
    background: var(--background);
}

.actions-cell {
    display: flex;
    gap: 0.25rem;
}

.btn-danger {
    color: var(--error);
}

.btn-danger:hover {
    background: var(--error-light);
}

.loading-state,
.error-state {
    text-align: center;
    padding: 2rem;
    color: var(--text-secondary);
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal.hidden {
    display: none;
}

.modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.modal-content {
    position: relative;
    background: var(--surface);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-small {
    max-width: 400px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text);
}

.modal-close {
    background: none;
    border: none;
    padding: 0.25rem;
    cursor: pointer;
    color: var(--text-secondary);
    transition: color 0.2s;
}

.modal-close:hover {
    color: var(--text);
}

.modal-body {
    padding: 1.5rem;
}

.modal-body p {
    margin: 0 0 1rem;
    color: var(--text);
}

.modal-body p:last-child {
    margin-bottom: 0;
}

.text-warning {
    color: var(--warning);
    font-size: 0.875rem;
}

.modal-form {
    padding: 1.5rem;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    padding: 1.5rem;
    border-top: 1px solid var(--border);
}

.temp-password-box {
    margin-top: 1rem;
    padding: 1rem;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: 8px;
}

.temp-password-box label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text);
}

.temp-password {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
}

.temp-password code {
    flex: 1;
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    font-size: 0.875rem;
    color: var(--primary);
    word-break: break-all;
}

@media (max-width: 768px) {
    .modal-content {
        max-width: 100%;
    }
    
    .users-table {
        font-size: 0.75rem;
    }
    
    .users-table th,
    .users-table td {
        padding: 0.5rem;
    }
    
    .profile-actions {
        flex-direction: column;
    }
    
    .profile-actions button {
        width: 100%;
    }
}
</style>
{{end}}

