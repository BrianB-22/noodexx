{{define "dashboard-content"}}
<div class="dashboard">
    <h1>Dashboard</h1>
    
    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìÑ</div>
            <div class="stat-value">{{.DocumentCount}}</div>
            <div class="stat-label">Documents Indexed</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ü§ñ</div>
            <div class="stat-value">{{.Provider}}</div>
            <div class="stat-label">LLM Provider</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚è∞</div>
            <div class="stat-value">{{.LastIngestion}}</div>
            <div class="stat-label">Last Ingestion</div>
        </div>
        
        {{if .PrivacyMode}}
        <div class="stat-card privacy">
            <div class="stat-icon">üîí</div>
            <div class="stat-value">Active</div>
            <div class="stat-label">Privacy Mode</div>
        </div>
        {{end}}
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a href="/chat" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"/>
                </svg>
                New Chat
            </a>
            <a href="/library" class="btn btn-secondary">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                </svg>
                Browse Library
            </a>
            <button class="btn btn-secondary" onclick="document.getElementById('file-upload-input').click()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                </svg>
                Upload Document
            </button>
            <input type="file" id="file-upload-input" style="display: none;" onchange="uploadFromDashboard(this)">
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="activity-section">
        <h2>Recent Activity</h2>
        <div class="activity-feed" 
             hx-get="/api/activity" 
             hx-trigger="load, every 30s"
             hx-swap="innerHTML">
            <div class="loading">Loading activity...</div>
        </div>
    </div>
</div>

<script>
function uploadFromDashboard(input) {
    const file = input.files[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('file', file);
    
    fetch('/api/ingest/file', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showToast === 'function') {
                showToast('Document uploaded successfully', 'success');
            }
            // Refresh activity feed
            if (typeof htmx !== 'undefined') {
                htmx.trigger('.activity-feed', 'refresh');
            }
        } else {
            if (typeof showToast === 'function') {
                showToast(data.error || 'Upload failed', 'error');
            }
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        if (typeof showToast === 'function') {
            showToast('Upload failed', 'error');
        }
    })
    .finally(() => {
        input.value = ''; // Reset input
    });
}
</script>
{{end}}
