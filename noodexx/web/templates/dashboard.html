{{define "dashboard-content"}}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Dashboard Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <h1 class="text-3xl font-bold text-surface-900 dark:text-surface-100">Dashboard</h1>
        {{if .UserMode}}
        {{if eq .UserMode "multi"}}
        {{if .CurrentUser}}
        <button 
            type="button"
            onclick="logoutFromDashboard()"
            aria-label="Logout"
            class="inline-flex items-center justify-center font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed px-4 py-2 text-base rounded-lg bg-transparent text-surface-700 hover:bg-surface-100 active:bg-surface-200 focus:ring-surface-500 dark:text-surface-300 dark:hover:bg-surface-800 dark:active:bg-surface-700 mt-4 sm:mt-0"
        >
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" class="mr-2">
                <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"/>
            </svg>
            Logout
        </button>
        {{end}}
        {{end}}
        {{end}}
    </div>
    
    <!-- Stats Cards Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <!-- Documents Card -->
        {{template "card" dict 
            "Class" "hover:shadow-lg transition-shadow"
            "Content" (printf `<div class="flex items-center"><div class="text-4xl mr-4">üìÑ</div><div><div class="text-2xl font-bold text-surface-900 dark:text-surface-100">%v</div><div class="text-sm text-surface-600 dark:text-surface-400">Documents Indexed</div></div></div>` .DocumentCount)
        }}
        
        <!-- Provider Card -->
        {{template "card" dict 
            "Class" "hover:shadow-lg transition-shadow"
            "Content" (printf `<div class="flex items-center"><div class="text-4xl mr-4">ü§ñ</div><div><div class="text-2xl font-bold text-surface-900 dark:text-surface-100">%v</div><div class="text-sm text-surface-600 dark:text-surface-400">LLM Provider</div></div></div>` .Provider)
        }}
        
        <!-- Last Ingestion Card -->
        {{template "card" dict 
            "Class" "hover:shadow-lg transition-shadow"
            "Content" (printf `<div class="flex items-center"><div class="text-4xl mr-4">‚è∞</div><div><div class="text-2xl font-bold text-surface-900 dark:text-surface-100">%v</div><div class="text-sm text-surface-600 dark:text-surface-400">Last Ingestion</div></div></div>` .LastIngestion)
        }}
        
        <!-- Privacy Mode Card (conditional) -->
        {{if .PrivacyMode}}
        {{template "card" dict 
            "Class" "hover:shadow-lg transition-shadow border-success-500 dark:border-success-600"
            "Content" `<div class="flex items-center"><div class="text-4xl mr-4">üîí</div><div><div class="text-2xl font-bold text-success-700 dark:text-success-400">Active</div><div class="text-sm text-surface-600 dark:text-surface-400">Privacy Mode</div></div></div>`
        }}
        {{end}}
    </div>
    
    <!-- Quick Actions Section -->
    {{template "card" dict 
        "Title" "Quick Actions"
        "Class" "mb-8"
        "Content" `<div class="flex flex-col sm:flex-row gap-3">
            <a href="/chat" class="inline-flex items-center justify-center px-4 py-2 text-base font-medium rounded-lg bg-primary-600 text-white hover:bg-primary-700 active:bg-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors dark:bg-primary-600 dark:hover:bg-primary-700 dark:active:bg-primary-800">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="mr-2">
                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"/>
                </svg>
                New Chat
            </a>
            <a href="/library" class="inline-flex items-center justify-center px-4 py-2 text-base font-medium rounded-lg bg-surface-200 text-surface-900 hover:bg-surface-300 active:bg-surface-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-surface-500 transition-colors dark:bg-surface-700 dark:text-surface-100 dark:hover:bg-surface-600 dark:active:bg-surface-500">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="mr-2">
                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                </svg>
                Browse Library
            </a>
            <button type="button" onclick="document.getElementById('file-upload-input').click()" class="inline-flex items-center justify-center px-4 py-2 text-base font-medium rounded-lg bg-surface-200 text-surface-900 hover:bg-surface-300 active:bg-surface-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-surface-500 transition-colors dark:bg-surface-700 dark:text-surface-100 dark:hover:bg-surface-600 dark:active:bg-surface-500">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="mr-2">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                </svg>
                Upload Document
            </button>
            <input type="file" id="file-upload-input" style="display: none;" onchange="uploadFromDashboard(this)">
        </div>`
    }}
    
    <!-- Recent Activity Section -->
    {{template "card" dict 
        "Title" "Recent Activity"
        "Content" `<div class="activity-feed min-h-[200px]" 
             hx-get="/api/activity" 
             hx-trigger="load, every 30s"
             hx-swap="innerHTML">
            <div class="flex items-center justify-center py-12 text-surface-600 dark:text-surface-400">
                <svg class="animate-spin h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading activity...
            </div>
        </div>`
    }}
</div>

<script>
function logoutFromDashboard() {
    // Reuse the existing logout function from base template
    if (typeof logoutFromMenu === 'function') {
        logoutFromMenu();
    } else {
        // Fallback implementation
        fetch('/api/logout', {
            method: 'POST'
        })
        .then(response => {
            if (response.ok) {
                window.location.href = '/login';
            } else {
                console.error('Logout failed');
                // Dispatch toast event for error notification
                window.dispatchEvent(new CustomEvent('toast', {
                    detail: { variant: 'error', message: 'Failed to logout. Please try again.' }
                }));
            }
        })
        .catch(error => {
            console.error('Logout error:', error);
            // Dispatch toast event for error notification
            window.dispatchEvent(new CustomEvent('toast', {
                detail: { variant: 'error', message: 'Failed to logout. Please try again.' }
            }));
        });
    }
}

function uploadFromDashboard(input) {
    const file = input.files[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('file', file);
    
    fetch('/api/ingest/file', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Dispatch toast event for success notification
            window.dispatchEvent(new CustomEvent('toast', {
                detail: { variant: 'success', message: 'Document uploaded successfully' }
            }));
            // Refresh activity feed
            if (typeof htmx !== 'undefined') {
                htmx.trigger('.activity-feed', 'refresh');
            }
        } else {
            // Dispatch toast event for error notification
            window.dispatchEvent(new CustomEvent('toast', {
                detail: { variant: 'error', message: data.error || 'Upload failed' }
            }));
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        // Dispatch toast event for error notification
        window.dispatchEvent(new CustomEvent('toast', {
            detail: { variant: 'error', message: 'Upload failed' }
        }));
    })
    .finally(() => {
        input.value = ''; // Reset input
    });
}
</script>
{{end}}
